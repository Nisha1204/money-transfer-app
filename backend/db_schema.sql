-- 1. Setup Database
CREATE DATABASE IF NOT EXISTS money_db;
USE money_db;

-- 2. Drop existing tables in reverse order of dependency
SET FOREIGN_KEY_CHECKS = 0;
DROP TABLE IF EXISTS transaction_logs;
DROP TABLE IF EXISTS accounts;
DROP TABLE IF EXISTS users;
SET FOREIGN_KEY_CHECKS = 1;

---

-- 3. Create Tables

-- Users Table (No foreign keys)
CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    role VARCHAR(20) NOT NULL
) ENGINE=InnoDB;

-- Accounts Table (Depends on users)
CREATE TABLE accounts (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    holder_name VARCHAR(255) DEFAULT NULL,
    -- Using DECIMAL for financial accuracy to match BigDecimal in Java
    balance DECIMAL(19, 2) NOT NULL DEFAULT 0.00, 
    status VARCHAR(20) NOT NULL, -- To match the AccountStatus Enum
    version INT DEFAULT 1,
    last_updated DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    user_id INT,
    CONSTRAINT fk_user_account 
        FOREIGN KEY (user_id) REFERENCES users(id) 
        ON DELETE CASCADE
) ENGINE=InnoDB;

-- Transaction Logs Table (Depends on accounts)
CREATE TABLE transaction_logs (
    -- Change to VARCHAR if you want to use UUIDs, or stay BIGINT for auto-increment
    id VARCHAR(64) PRIMARY KEY,
    fromAccountId BIGINT NOT NULL,
    toAccountId BIGINT NOT NULL,
    amount DECIMAL(19, 2) NOT NULL,
    status VARCHAR(20) NOT NULL,
    failureReason VARCHAR(255) NULL,
    idempotencyKey VARCHAR(255) NULL,
    createdOn DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_from_account FOREIGN KEY (fromAccountId) REFERENCES accounts(id),
    CONSTRAINT fk_to_account FOREIGN KEY (toAccountId) REFERENCES accounts(id)
) ENGINE=InnoDB;

SET FOREIGN_KEY_CHECKS = 0;
TRUNCATE TABLE transaction_logs;
TRUNCATE TABLE accounts;
SET FOREIGN_KEY_CHECKS = 1;

-- Set the starting ID for real-world look
ALTER TABLE accounts AUTO_INCREMENT = 1001001001;

-- Insert Accounts with the new ID sequence
INSERT INTO accounts (holder_name, balance, status, version, user_id) VALUES
('Alice Green', 12500.50, 'ACTIVE', 1, 1), -- ID: 1001001001
('Alice Green', 450.00,   'ACTIVE', 1, 1), -- ID: 1001001002
('Bob Smith',   8200.00,  'ACTIVE', 1, 2), -- ID: 1001001003
('Bob Smith',   0.00,     'CLOSED', 1, 2), -- ID: 1001001004
('Charlie Vance', 3100.00, 'ACTIVE', 1, 3), -- ID: 1001001005
('David Miller', 150.00,   'LOCKED', 1, 4), -- ID: 1001001006
('Emma Clark',   9800.00, 'ACTIVE', 1, 5), -- ID: 1001001007
('Emma Clark',   12000.00,'ACTIVE', 1, 5); -- ID: 1001001008


-- CLEAR OLD LOGS BEFORE RE-SEEDING TO ENSURE CLEAN DATA
DELETE FROM transaction_logs;

-- MONDAY FEB 9 (11 logs)
INSERT INTO transaction_logs (id, fromAccountId, toAccountId, amount, status, failureReason, createdOn, idempotencyKey) VALUES
('TRX-82910', 1001001001, 1001001003, 500, 'SUCCESS', NULL, '2026-02-09 09:10', 'u01'),
('TRX-74125', 1001001003, 1001001005, 120, 'SUCCESS', NULL, '2026-02-09 10:15', 'u02'),
('TRX-33698', 1001001005, 1001001001, 85, 'SUCCESS', NULL, '2026-02-09 11:30', 'u03'),
('TRX-10254', 1001001007, 1001001008, 45, 'SUCCESS', NULL, '2026-02-09 12:45', 'u04'),
('TRX-99632', 1001001008, 1001001001, 200, 'SUCCESS', NULL, '2026-02-09 13:00', 'u05'),
('TRX-55410', 1001001001, 1001001007, 310, 'SUCCESS', NULL, '2026-02-09 14:20', 'u06'),
('TRX-21478', 1001001003, 1001001008, 90, 'SUCCESS', NULL, '2026-02-09 15:10', 'u07'),
('TRX-88541', 1001001005, 1001001003, 15, 'SUCCESS', NULL, '2026-02-09 16:40', 'u08'),
('TRX-63201', 1001001007, 1001001001, 100, 'SUCCESS', NULL, '2026-02-09 18:00', 'u09'),
('TRX-44125', 1001001002, 1001001001, 50, 'FAILED', 'Insufficient balance', '2026-02-09 19:30', 'u10'),
('TRX-77410', 1001001001, 1001001002, 50, 'SUCCESS', NULL, '2026-02-09 21:00', 'u11');

-- TUESDAY FEB 10 (10 logs)
INSERT INTO transaction_logs (id, fromAccountId, toAccountId, amount, status, failureReason, createdOn, idempotencyKey) VALUES
('TRX-12036', 1001001003, 1001001001, 700, 'SUCCESS', NULL, '2026-02-10 08:30', 't01'),
('TRX-96541', 1001001005, 1001001007, 250, 'SUCCESS', NULL, '2026-02-10 09:45', 't02'),
('TRX-32145', 1001001001, 1001001008, 45, 'SUCCESS', NULL, '2026-02-10 11:00', 't03'),
('TRX-88741', 1001001007, 1001001005, 120, 'SUCCESS', NULL, '2026-02-10 12:15', 't04'),
('TRX-55210', 1001001008, 1001001003, 90, 'SUCCESS', NULL, '2026-02-10 14:50', 't05'),
('TRX-33214', 1001001002, 1001001005, 30, 'FAILED', 'Insufficient balance', '2026-02-10 15:30', 't06'),
('TRX-96301', 1001001001, 1001001003, 150, 'SUCCESS', NULL, '2026-02-10 16:10', 't07'),
('TRX-44510', 1001001003, 1001001005, 60, 'SUCCESS', NULL, '2026-02-10 17:05', 't08'),
('TRX-22103', 1001001005, 1001001008, 400, 'SUCCESS', NULL, '2026-02-10 18:40', 't09'),
('TRX-77412', 1001001007, 1001001001, 20, 'SUCCESS', NULL, '2026-02-10 20:00', 't10');

-- WEDNESDAY FEB 11 (12 logs)
INSERT INTO transaction_logs (id, fromAccountId, toAccountId, amount, status, failureReason, createdOn, idempotencyKey) VALUES
('TRX-10203', 1001001001, 1001001005, 300, 'SUCCESS', NULL, '2026-02-11 09:00', 'w01'),
('TRX-44587', 1001001003, 1001001007, 50, 'SUCCESS', NULL, '2026-02-11 10:20', 'w02'),
('TRX-36985', 1001001005, 1001001003, 15, 'SUCCESS', NULL, '2026-02-11 11:30', 'w03'),
('TRX-11247', 1001001007, 1001001008, 1200, 'SUCCESS', NULL, '2026-02-11 12:50', 'w04'),
('TRX-88514', 1001001008, 1001001001, 450, 'SUCCESS', NULL, '2026-02-11 13:40', 'w05'),
('TRX-20136', 1001001001, 1001001002, 600, 'SUCCESS', NULL, '2026-02-11 14:15', 'w06'),
('TRX-96584', 1001001003, 1001001001, 200, 'SUCCESS', NULL, '2026-02-11 15:50', 'w07'),
('TRX-33201', 1001001005, 1001001001, 10, 'SUCCESS', NULL, '2026-02-11 16:30', 'w08'),
('TRX-44781', 1001001007, 1001001005, 80, 'SUCCESS', NULL, '2026-02-11 17:45', 'w09'),
('TRX-11254', 1001001008, 1001001003, 30, 'SUCCESS', NULL, '2026-02-11 18:20', 'w10'),
('TRX-99854', 1001001002, 1001001003, 500, 'FAILED', 'Insufficient balance', '2026-02-11 19:10', 'w11'),
('TRX-33256', 1001001001, 1001001007, 150, 'SUCCESS', NULL, '2026-02-11 20:30', 'w12');

-- THURSDAY FEB 12 (11 logs)
INSERT INTO transaction_logs (id, fromAccountId, toAccountId, amount, status, failureReason, createdOn, idempotencyKey) VALUES
('TRX-44120', 1001001003, 1001001008, 900, 'SUCCESS', NULL, '2026-02-12 09:15', 'th01'),
('TRX-96325', 1001001001, 1001001005, 40, 'SUCCESS', NULL, '2026-02-12 10:30', 'th02'),
('TRX-33658', 1001001005, 1001001007, 120, 'SUCCESS', NULL, '2026-02-12 11:45', 'th03'),
('TRX-11245', 1001001007, 1001001001, 35, 'SUCCESS', NULL, '2026-02-12 12:55', 'th04'),
('TRX-99635', 1001001008, 1001001005, 200, 'SUCCESS', NULL, '2026-02-12 14:10', 'th05'),
('TRX-44102', 1001001001, 1001001003, 15, 'SUCCESS', NULL, '2026-02-12 15:25', 'th06'),
('TRX-63254', 1001001003, 1001001005, 600, 'SUCCESS', NULL, '2026-02-12 16:40', 'th07'),
('TRX-77412', 1001001005, 1001001001, 100, 'SUCCESS', NULL, '2026-02-12 17:50', 'th08'),
('TRX-22105', 1001001007, 1001001008, 50, 'SUCCESS', NULL, '2026-02-12 19:10', 'th09'),
('TRX-99874', 1001001008, 1001001001, 75, 'SUCCESS', NULL, '2026-02-12 20:20', 'th10'),
('TRX-44105', 1001001002, 1001001001, 1000, 'FAILED', 'Insufficient balance', '2026-02-12 21:30', 'th11');

-- FRIDAY FEB 13 (13 logs)
INSERT INTO transaction_logs (id, fromAccountId, toAccountId, amount, status, failureReason, createdOn, idempotencyKey) VALUES
('TRX-33210', 1001001001, 1001001003, 250, 'SUCCESS', NULL, '2026-02-13 08:30', 'f01'),
('TRX-96587', 1001001003, 1001001005, 150, 'SUCCESS', NULL, '2026-02-13 09:40', 'f02'),
('TRX-33254', 1001001005, 1001001007, 80, 'SUCCESS', NULL, '2026-02-13 10:50', 'f03'),
('TRX-11248', 1001001007, 1001001008, 120, 'SUCCESS', NULL, '2026-02-13 11:55', 'f04'),
('TRX-99638', 1001001008, 1001001001, 40, 'SUCCESS', NULL, '2026-02-13 13:10', 'f05'),
('TRX-44106', 1001001001, 1001001007, 1500, 'SUCCESS', NULL, '2026-02-13 14:25', 'f06'),
('TRX-63259', 1001001003, 1001001008, 220, 'SUCCESS', NULL, '2026-02-13 15:35', 'f07'),
('TRX-77416', 1001001005, 1001001003, 90, 'SUCCESS', NULL, '2026-02-13 16:45', 'f08'),
('TRX-22109', 1001001007, 1001001001, 30, 'SUCCESS', NULL, '2026-02-13 17:55', 'f09'),
('TRX-99878', 1001001008, 1001001005, 600, 'SUCCESS', NULL, '2026-02-13 19:05', 'f10'),
('TRX-44109', 1001001002, 1001001003, 10, 'FAILED', 'Insufficient balance', '2026-02-13 20:15', 'f11'),
('TRX-33259', 1001001001, 1001001005, 45, 'SUCCESS', NULL, '2026-02-13 21:25', 'f12'),
('TRX-96590', 1001001003, 1001001007, 300, 'SUCCESS', NULL, '2026-02-13 22:35', 'f13');

-- SATURDAY FEB 14 (30 logs - VALENTINE SPIKE)
INSERT INTO transaction_logs (id, fromAccountId, toAccountId, amount, status, failureReason, createdOn, idempotencyKey) VALUES
('TRX-11200', 1001001001, 1001001003, 100, 'SUCCESS', NULL, '2026-02-14 09:00', 's01'),
('TRX-11201', 1001001003, 1001001005, 200, 'SUCCESS', NULL, '2026-02-14 09:15', 's02'),
('TRX-11202', 1001001005, 1001001007, 300, 'SUCCESS', NULL, '2026-02-14 09:30', 's03'),
('TRX-11203', 1001001007, 1001001008, 400, 'SUCCESS', NULL, '2026-02-14 09:45', 's04'),
('TRX-11204', 1001001008, 1001001001, 500, 'SUCCESS', NULL, '2026-02-14 10:00', 's05'),
('TRX-11205', 1001001001, 1001001007, 600, 'SUCCESS', NULL, '2026-02-14 10:15', 's06'),
('TRX-11206', 1001001003, 1001001008, 700, 'SUCCESS', NULL, '2026-02-14 10:30', 's07'),
('TRX-11207', 1001001005, 1001001003, 800, 'SUCCESS', NULL, '2026-02-14 10:45', 's08'),
('TRX-11208', 1001001007, 1001001001, 900, 'SUCCESS', NULL, '2026-02-14 11:00', 's09'),
('TRX-11209', 1001001008, 1001001005, 1000, 'SUCCESS', NULL, '2026-02-14 11:15', 's10'),
('TRX-11210', 1001001001, 1001001005, 1100, 'SUCCESS', NULL, '2026-02-14 11:30', 's11'),
('TRX-11211', 1001001003, 1001001007, 1200, 'SUCCESS', NULL, '2026-02-14 11:45', 's12'),
('TRX-11212', 1001001005, 1001001008, 1300, 'SUCCESS', NULL, '2026-02-14 12:00', 's13'),
('TRX-11213', 1001001007, 1001001001, 1400, 'SUCCESS', NULL, '2026-02-14 12:15', 's14'),
('TRX-11214', 1001001008, 1001001005, 1500, 'SUCCESS', NULL, '2026-02-14 12:30', 's15'),
('TRX-11215', 1001001001, 1001001003, 1600, 'SUCCESS', NULL, '2026-02-14 12:45', 's16'),
('TRX-11216', 1001001003, 1001001001, 1700, 'SUCCESS', NULL, '2026-02-14 13:00', 's17'),
('TRX-11217', 1001001005, 1001001007, 1800, 'SUCCESS', NULL, '2026-02-14 13:15', 's18'),
('TRX-11218', 1001001007, 1001001003, 1900, 'SUCCESS', NULL, '2026-02-14 13:30', 's19'),
('TRX-11219', 1001001008, 1001001005, 2000, 'SUCCESS', NULL, '2026-02-14 13:45', 's20'),
('TRX-11220', 1001001001, 1001001005, 2100, 'SUCCESS', NULL, '2026-02-14 14:00', 's21'),
('TRX-11221', 1001001003, 1001001007, 2200, 'SUCCESS', NULL, '2026-02-14 14:15', 's22'),
('TRX-11222', 1001001005, 1001001008, 2300, 'SUCCESS', NULL, '2026-02-14 14:30', 's23'),
('TRX-11223', 1001001007, 1001001001, 2400, 'SUCCESS', NULL, '2026-02-14 14:45', 's24'),
('TRX-11224', 1001001008, 1001001005, 2500, 'SUCCESS', NULL, '2026-02-14 15:00', 's25'),
('TRX-11225', 1001001006, 1001001001, 50, 'FAILED', 'Account is LOCKED', '2026-02-14 15:30', 's26'),
('TRX-11226', 1001001002, 1001001001, 12000, 'FAILED', 'Insufficient balance', '2026-02-14 16:00', 's27'),
('TRX-11227', 1001001003, 1001001001, 150, 'SUCCESS', NULL, '2026-02-14 17:00', 's28'),
('TRX-11228', 1001001001, 1001001008, 300, 'SUCCESS', NULL, '2026-02-14 18:30', 's29'),
('TRX-11229', 1001001007, 1001001005, 450, 'SUCCESS', NULL, '2026-02-14 20:00', 's30');

-- SUNDAY FEB 15
INSERT INTO transaction_logs (id, fromAccountId, toAccountId, amount, status, failureReason, createdOn, idempotencyKey) VALUES
('TRX-20501', 1001001001, 1001001007, 200.00, 'SUCCESS', NULL, '2026-02-15 10:00:00', 'u-sun01'),
('TRX-20502', 1001001003, 1001001008, 150.00, 'SUCCESS', NULL, '2026-02-15 10:30:00', 'u-sun02'),
('TRX-20503', 1001001005, 1001001001, 50.00, 'SUCCESS', NULL, '2026-02-15 11:00:00', 'u-sun03'),
('TRX-20504', 1001001007, 1001001003, 300.00, 'SUCCESS', NULL, '2026-02-15 11:45:00', 'u-sun04'),
('TRX-20505', 1001001008, 1001001005, 900.00, 'SUCCESS', NULL, '2026-02-15 12:15:00', 'u-sun05'),
('TRX-20506', 1001001001, 1001001003, 4000.00, 'FAILED', 'Limit reached', '2026-02-15 13:00:00', 'u-sun06'),
('TRX-20507', 1001001003, 1001001001, 120.00, 'SUCCESS', NULL, '2026-02-15 13:30:00', 'u-sun07'),
('TRX-20508', 1001001005, 1001001003, 60.00, 'SUCCESS', NULL, '2026-02-15 14:00:00', 'u-sun08'),
('TRX-20509', 1001001007, 1001001005, 25.00, 'SUCCESS', NULL, '2026-02-15 14:30:00', 'u-sun09'),
('TRX-20510', 1001001008, 1001001007, 1000.00, 'SUCCESS', NULL, '2026-02-15 15:00:00', 'u-sun10'),
('TRX-20511', 1001001001, 1001001008, 300.00, 'SUCCESS', NULL, '2026-02-15 16:00:00', 'u-sun11'),
('TRX-20512', 1001001003, 1001001005, 450.00, 'SUCCESS', NULL, '2026-02-15 17:00:00', 'u-sun12'),
('TRX-20513', 1001001005, 1001001007, 110.00, 'SUCCESS', NULL, '2026-02-15 18:00:00', 'u-sun13'),
('TRX-20514', 1001001007, 1001001001, 220.00, 'SUCCESS', NULL, '2026-02-15 19:00:00', 'u-sun14'),
('TRX-20515', 1001001008, 1001001003, 75.00, 'SUCCESS', NULL, '2026-02-15 20:00:00', 'u-sun15'),
('TRX-30101', 1001001001, 1001001003, 200.00, 'SUCCESS', NULL, '2026-02-15 08:15:22', 'uuid-101'),
('TRX-30102', 1001001003, 1001001001, 1200.00, 'SUCCESS', NULL, '2026-02-15 09:00:45', 'uuid-103'),
('TRX-30103', 1001001005, 1001001008, 3000.00, 'FAILED', 'Insufficient balance', '2026-02-15 09:15:00', 'uuid-104'),
('TRX-30104', 1001001008, 1001001001, 450.00, 'SUCCESS', NULL, '2026-02-15 09:45:30', 'uuid-105'),
('TRX-30105', 1001001001, 1001001007, 15.50, 'SUCCESS', NULL, '2026-02-15 12:05:10', 'uuid-106'),
('TRX-30106', 1001001001, 1001001008, 100.00, 'SUCCESS', NULL, '2026-02-15 12:30:00', 'uuid-109'),
('TRX-30107', 1001001005, 1001001003, 45.00, 'SUCCESS', NULL, '2026-02-15 12:35:15', 'uuid-110'),
('TRX-30108', 1001001008, 1001001007, 200.00, 'SUCCESS', NULL, '2026-02-15 12:40:55', 'uuid-111'),
('TRX-30109', 1001001003, 1001001002, 500.00, 'FAILED', 'Insufficient balance', '2026-02-15 12:45:00', 'uuid-112'),
('TRX-30110', 1001001001, 1001001005, 12.00, 'SUCCESS', NULL, '2026-02-15 13:00:10', 'uuid-113'),
('TRX-30111', 1001001007, 1001001003, 80.00, 'SUCCESS', NULL, '2026-02-15 13:10:20', 'uuid-114'),
('TRX-30112', 1001001002, 1001001001, 600.00, 'FAILED', 'Insufficient balance', '2026-02-15 13:45:00', 'uuid-117'),
('TRX-30113', 1001001003, 1001001008, 1000.00, 'SUCCESS', NULL, '2026-02-15 13:55:00', 'uuid-118');

-- MONDAY FEB 16
INSERT INTO transaction_logs (id, fromAccountId, toAccountId, amount, status, failureReason, createdOn, idempotencyKey) VALUES
('TRX-40001', 1001001001, 1001001005, 1200.00, 'SUCCESS', NULL, '2026-02-16 08:05:00', 'uuid-m16-01'),
('TRX-40002', 1001001003, 1001001007, 45.50, 'SUCCESS', NULL, '2026-02-16 08:30:15', 'uuid-m16-02'),
('TRX-40003', 1001001007, 1001001008, 3000.00, 'SUCCESS', NULL, '2026-02-16 09:00:00', 'uuid-m16-03'),
('TRX-40004', 1001001005, 1001001002, 150.00, 'SUCCESS', NULL, '2026-02-16 09:20:45', 'uuid-m16-04'),
('TRX-40005', 1001001008, 1001001001, 5000.00, 'FAILED', 'Insufficient balance', '2026-02-16 09:45:00', 'uuid-m16-05');