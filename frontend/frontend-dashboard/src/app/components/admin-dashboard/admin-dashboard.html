<mat-toolbar class="main-toolbar">
  <div class="brand">
    <mat-icon class="logo-icon">analytics</mat-icon>
    <span>FINTECH<strong>CORE</strong> | ADMIN</span>
  </div>
  <span class="spacer"></span>
  <button mat-icon-button (click)="fetchStats()" matTooltip="Sync Snowflake">
    <mat-icon>sync</mat-icon>
  </button>
  <button mat-flat-button class="logout-btn" (click)="logout()">
    <mat-icon>logout</mat-icon>
    Logout
  </button>
</mat-toolbar>

<div class="dashboard-container">
  <div class="center-state" *ngIf="loading">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Querying Snowflake Warehouse...</p>
  </div>

  <div class="dashboard-content" *ngIf="!loading && !error">
    <div class="kpi-grid">
      <div class="kpi-card">
        <span class="kpi-label">Success Rate</span>
        <div class="kpi-value green">{{ stats?.successRate | number:'1.1-1' }}%</div>
        <div class="kpi-sub">System Health</div>
      </div>
      <div class="kpi-card">
        <span class="kpi-label">Avg Ticket</span>
        <div class="kpi-value">â‚¹{{ stats?.avgAmount | number:'1.0-0' }}</div>
        <div class="kpi-sub">Per Success</div>
      </div>
      <div class="kpi-card">
        <span class="kpi-label">Daily Vol</span>
        <div class="kpi-value blue">{{ stats?.dailyTransactions }}</div>
        <div class="kpi-sub">Today</div>
      </div>
      <div class="kpi-card">
        <span class="kpi-label">Peak Hour</span>
        <div class="kpi-value orange">{{ stats?.peakHour }}:00</div>
        <div class="kpi-sub">Busiest Time</div>
      </div>
    </div>

    <div class="visual-grid">
      <mat-card class="chart-card">
        <mat-card-header><mat-card-title>Transaction Velocity (7 Days)</mat-card-title></mat-card-header>
        <div class="chart-container">
          <canvas baseChart [data]="lineChartData" [options]="lineChartOptions" [type]="'line'"></canvas>
        </div>
      </mat-card>

      <mat-card class="info-card">
        <mat-card-header><mat-card-title>Warehouse Integrity</mat-card-title></mat-card-header>
        <mat-card-content>
          <div class="meta-row">
            <mat-icon>account_tree</mat-icon>
            <div>
              <div class="meta-label">Top User</div>
              <div class="meta-val">{{ stats?.topAccount }}</div>
            </div>
          </div>
          <div class="meta-row">
            <mat-icon>cloud_done</mat-icon>
            <div>
              <div class="meta-label">Status</div>
              <div class="meta-val green">Sync Completed</div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div>